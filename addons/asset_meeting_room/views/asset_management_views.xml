<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Asset Category Views -->
    <record id="view_asset_category_tree" model="ir.ui.view">
        <field name="name">asset.category.tree</field>
        <field name="model">asset.category</field>
        <field name="arch" type="xml">
            <tree string="Phân loại tài sản">
                <field name="code"/>
                <field name="name"/>
                <field name="total_count"/>
                <field name="stored_count"/>
                <field name="borrowed_count"/>
            </tree>
        </field>
    </record>

    <record id="view_asset_category_form" model="ir.ui.view">
        <field name="name">asset.category.form</field>
        <field name="model">asset.category</field>
        <field name="arch" type="xml">
            <form string="Asset Category">
                <sheet>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only" string="Tên loại tài sản"/>
                        <h1>
                            <field name="name" placeholder="Ví dụ: Máy tính xách tay"/>
                        </h1>
                        <field name="code" placeholder="Mã loại (ví dụ: LTS)"/>
                    </div>
                    
                    <div class="row mt-4">
                        <!-- Dashboard-like statistics inspired by the image -->
                        <div class="col-8">
                            <notebook>
                                <page string="Danh sách tài sản" name="assets">
                                    <field name="asset_ids" context="{'default_category_id': active_id}">
                                        <tree editable="bottom">
                                            <field name="code"/>
                                            <field name="name"/>
                                            <field name="serial_number"/>
                                            <field name="purchase_date"/>
                                            <field name="warranty_date" optional="hide"/>
                                            <field name="purchase_value" sum="Total Purchase"/>
                                            <field name="current_value" sum="Total Current"/>
                                            <field name="state"/>
                                            <button name="unlink" type="object" icon="fa-trash-o" title="Delete"/>
                                        </tree>
                                    </field>
                                </page>
                                <page string="Mô tả" name="description">
                                    <field name="description" placeholder="Mô tả chi tiết về loại tài sản này..."/>
                                </page>
                            </notebook>
                        </div>
                        <div class="col-4" style="border-left: 1px solid #dee2e6;">
                            <div class="card bg-light">
                                <div class="card-header font-weight-bold text-uppercase" style="color: #e67e22;">
                                    Thống kê số lượng
                                </div>
                                <div class="card-body">
                                    <div class="d-flex justify-content-between mb-2 pb-1 border-bottom">
                                        <span>Tổng số lượng</span>
                                        <span class="badge badge-pill badge-primary"><field name="total_count"/></span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2 pb-1 border-bottom">
                                        <span class="text-success">Lưu trữ</span>
                                        <span class="badge badge-pill badge-success"><field name="stored_count"/></span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2 pb-1 border-bottom">
                                        <span class="text-info">Mượn</span>
                                        <span class="badge badge-pill badge-info"><field name="borrowed_count"/></span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2 pb-1 border-bottom">
                                        <span class="text-warning">Bảo trì</span>
                                        <span class="badge badge-pill badge-warning"><field name="maintenance_count"/></span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span class="text-danger">Hỏng</span>
                                        <span class="badge badge-pill badge-danger"><field name="broken_count"/></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_asset_category" model="ir.actions.act_window">
        <field name="name">Loại tài sản</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">asset.category</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- Asset Management Views -->
    <record id="view_asset_management_tree" model="ir.ui.view">
        <field name="name">asset.management.tree</field>
        <field name="model">asset.management</field>
        <field name="arch" type="xml">
            <tree string="Tài sản" decoration-info="state == 'borrowed'" decoration-warning="state == 'maintenance'" decoration-danger="state == 'broken'" decoration-muted="state == 'liquidated'">
                <field name="code"/>
                <field name="name"/>
                <field name="category_id"/>
                <field name="serial_number"/>
                <field name="purchase_date"/>
                <field name="purchase_value"/>
                <field name="state" widget="badge" decoration-success="state == 'stored'" decoration-info="state == 'borrowed'"/>
                <field name="assigned_to_id"/>
            </tree>
        </field>
    </record>

    <record id="view_asset_management_form" model="ir.ui.view">
        <field name="name">asset.management.form</field>
        <field name="model">asset.management</field>
        <field name="arch" type="xml">
            <form string="Tài sản">
                <header>
                    <button name="action_confirm_allocation" string="Cấp phát" type="object" class="oe_highlight" attrs="{'invisible': [('state', '!=', 'stored')]}"/>
                    <button name="action_return" string="Thu hồi" type="object" attrs="{'invisible': [('state', '!=', 'borrowed')]}"/>
                    <button name="action_liquidate" string="Thanh lý" type="object" attrs="{'invisible': [('state', 'not in', ['stored', 'broken'])]}"/>
                    <field name="state" widget="statusbar" statusbar_visible="stored,borrowed,maintenance,broken"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" placeholder="Tên tài sản"/>
                        </h1>
                        <h3>
                            <field name="code" placeholder="Mã tài sản..."/>
                        </h3>
                    </div>
                    <group>
                        <group string="Thông tin cơ bản">
                            <field name="category_id"/>
                            <field name="asset_type"/>
                            <field name="serial_number"/>
                            <field name="purchase_date"/>
                            <field name="warranty_date"/>
                        </group>
                        <group string="Trạng thái &amp; Giá trị">
                            <field name="purchase_value"/>
                            <field name="useful_life_years"/>
                            <field name="current_value"/>
                            <field name="last_inventory_date"/>
                            <field name="liquidation_date" attrs="{'invisible': [('state', '!=', 'liquidated')]}"/>
                            <field name="liquidation_price" attrs="{'invisible': [('state', '!=', 'liquidated')]}"/>
                            <field name="managing_unit_id"/>
                            <field name="assigned_to_id"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Mô tả" name="profile">
                            <field name="profile" placeholder="Mô tả kỹ thuật, thông tin chi tiết..."/>
                        </page>
                        <page string="Lịch sử cấp phát" name="allocation">
                            <field name="allocation_ids">
                                <tree editable="bottom">
                                    <field name="date_start"/>
                                    <field name="date_end"/>
                                    <field name="user_id"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Lịch sử bảo trì" name="maintenance">
                            <field name="maintenance_ids">
                                <tree editable="bottom">
                                    <field name="date" string="Ngày"/>
                                    <field name="description" string="Nội dung"/>
                                    <field name="repair_process" string="Quy trình sửa chữa"/>
                                    <field name="cost" sum="Tổng chi phí" string="Chi phí"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_asset_management_graph" model="ir.ui.view">
        <field name="name">asset.management.graph</field>
        <field name="model">asset.management</field>
        <field name="arch" type="xml">
            <graph string="Giá trị tài sản" type="bar">
                <field name="category_id"/>
                <field name="current_value" type="measure"/>
            </graph>
        </field>
    </record>

    <record id="action_asset_management" model="ir.actions.act_window">
        <field name="name">Quản lý tài sản</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">asset.management</field>
        <field name="view_mode">tree,form,graph</field>
    </record>
</odoo>
